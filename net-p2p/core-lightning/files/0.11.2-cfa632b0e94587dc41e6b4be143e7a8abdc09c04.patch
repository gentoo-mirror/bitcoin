--- /var/cache/distfiles/cfa632b0e94587dc41e6b4be143e7a8abdc09c04.patch	2023-02-04 17:55:18.553372048 -0500
+++ /var/tmp/portage/net-p2p/core-lightning-0.11.2-r113/temp/cfa632b0e94587dc41e6b4be143e7a8abdc09c04.patch	2023-02-04 20:12:17.521222136 -0500
@@ -40,9 +40,9 @@
 +	     p;
 +	     p = peer_node_id_map_next(ld->peers, &it)) {
  		list_for_each(&p->channels, chan, list) {
- 			/* BOLT-channel-type #2:
- 			 * - MUST always recognize the `alias` as a
+ 			if (chan->scid
+ 			    && short_channel_id_eq(scid, chan->scid))
 @@ -640,7 +645,12 @@ struct channel *channel_by_dbid(struct lightningd *ld, const u64 dbid)
  {
  	struct peer *p;
  	struct channel *chan;
@@ -444,6 +444,18 @@
  		num_peers++;
  
  		list_for_each(&peer->channels, channel, list) {
+@@ -2694,7 +2725,10 @@ static struct command_result *json_setchannelfee(struct command *cmd,
+ 
+ 	/* If the users requested 'all' channels we need to iterate */
+ 	if (channels == NULL) {
+-		list_for_each(&cmd->ld->peers, peer, list) {
++		struct peer_node_id_map_iter it;
++		for (peer = peer_node_id_map_first(cmd->ld->peers, &it);
++		     peer;
++		     peer = peer_node_id_map_next(cmd->ld->peers, &it)) {
+ 			struct channel *channel;
+ 			list_for_each(&peer->channels, channel, list) {
+ 				if (channel->state != CHANNELD_NORMAL &&
 @@ -2720,7 +2751,11 @@ static struct command_result *json_setchannel(struct command *cmd,
  
  	/* If the users requested 'all' channels we need to iterate */
