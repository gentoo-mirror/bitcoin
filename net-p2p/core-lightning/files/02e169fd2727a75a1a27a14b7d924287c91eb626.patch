--- /var/cache/distfiles/02e169fd2727a75a1a27a14b7d924287c91eb626.patch	2022-09-23 21:55:59.310379769 -0400
+++ /var/tmp/portage/net-p2p/core-lightning-0.11.2-r103/temp/02e169fd2727a75a1a27a14b7d924287c91eb626.patch	2022-09-23 23:01:55.959169512 -0400
@@ -244,19 +244,19 @@
  #include <lightningd/channel_control.h>
 +#include <lightningd/connect_control.h>
  #include <lightningd/hsm_control.h>
+ #include <lightningd/json.h>
  #include <lightningd/notification.h>
- #include <lightningd/opening_common.h>
 @@ -100,6 +101,7 @@ wallet_commit_channel(struct lightningd *ld,
+ 	s64 final_key_idx;
+ 	u64 static_remotekey_start;
  	u32 lease_start_blockheight = 0; /* No leases on v1 */
- 	struct short_channel_id *alias_local;
- 	struct timeabs timestamp;
 +	bool any_active = peer_any_active_channel(uc->peer, NULL);
  
  	/* We cannot both be the fundee *and* have a `fundchannel_start`
  	 * command running!
 @@ -233,6 +235,15 @@ wallet_commit_channel(struct lightningd *ld,
- 				     channel->state_change_cause,
- 				     "new channel opened");
+ 	/* Now we finally put it in the database. */
+ 	wallet_channel_insert(ld->wallet, channel);
  
 +
 +	/* We might have disconnected and decided we didn't need to
@@ -304,9 +304,9 @@
  	}
  
 @@ -1731,9 +1731,21 @@ static enum watch_result funding_depth_cb(struct lightningd *ld,
+ 			wallet_channel_save(ld->wallet, channel);
  
- 		} else if (!short_channel_id_eq(channel->scid, &scid) &&
- 			   !is_stub_scid(channel->scid)) {
+ 		} else if (!short_channel_id_eq(channel->scid, &scid)) {
 -			/* This normally restarts channeld, initialized with updated scid
 +			/* Send warning: that will make connectd disconnect, and then we'll
 +			 * try to reconnect. */
