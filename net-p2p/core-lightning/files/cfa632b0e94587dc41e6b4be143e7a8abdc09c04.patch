--- /var/cache/distfiles/cfa632b0e94587dc41e6b4be143e7a8abdc09c04.patch	2023-02-04 17:55:18.553372048 -0500
+++ /var/tmp/portage/net-p2p/core-lightning-0.12.1-r102/temp/cfa632b0e94587dc41e6b4be143e7a8abdc09c04.patch	2023-02-04 18:58:08.694980258 -0500
@@ -444,6 +444,18 @@
  		num_peers++;
  
  		list_for_each(&peer->channels, channel, list) {
+@@ -2712,7 +2743,10 @@ static struct command_result *json_setchannelfee(struct command *cmd,
+ 
+ 	/* If the users requested 'all' channels we need to iterate */
+ 	if (channels == NULL) {
+-		list_for_each(&cmd->ld->peers, peer, list) {
++		struct peer_node_id_map_iter it;
++		for (peer = peer_node_id_map_first(cmd->ld->peers, &it);
++		     peer;
++		     peer = peer_node_id_map_next(cmd->ld->peers, &it)) {
+ 			struct channel *channel;
+ 			list_for_each(&peer->channels, channel, list) {
+ 				if (channel->state != CHANNELD_NORMAL &&
 @@ -2720,7 +2751,11 @@ static struct command_result *json_setchannel(struct command *cmd,
  
  	/* If the users requested 'all' channels we need to iterate */
